<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Documentation Source: ecs.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.simplex.css">
	
</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top ">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Documentation</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="ECS.html">ECS</a>
						</li>
						
						<li>
							<a href="Entity.html">Entity</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="events.list.html" class="dropdown-toggle" data-toggle="dropdown">Events<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="ECS.html#event:addEntity">addEntity</a>
						</li>
						
						<li>
							<a href="ECS.html#event:removeEntity">removeEntity</a>
						</li>
						
						<li>
							<a href="Entity.html#event:add">add</a>
						</li>
						
						<li>
							<a href="Entity.html#event:update">update</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
			<div class="span12">
				
				<div id="main">
					


		<h1 class="page-title">Source: ecs.js</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript ">
/*global _getIndexByProperty */

/**
 * creates a new entity component system
 * @constructor
 * @fires ECS#addEntity
 * @fires ECS#removeEntity
 */
var ECS = function () {
  /**
   * list of entities
   * @member {array}
   */
  this.entities = [];

  /**
   * a dict of components schemas
   * @member {object}
   * @private
   */
  this._components = {};

  /**
   * a dict of entities schema
   * @member {object}
   * @private
   */
  this._entities = {};

  // make this object observable. Then it will broadcast entity changes
  // to make system update their entity list
  Observable.make(this);
};

/**
 * creates an entity
 *
 * @param {string|string[]} [arg] - create an entity with a set of default
 * components:
 * &lt;br/>
 *   - string: the name of the entity schema. The schema must be registered with
 * {@link ECS#registerEntity} before.
 * &lt;br/>
 *   - string[]: an array of components schemas names. The schemas must be
 * registered with {@link ECS#registerComponent} before.
 *
 * @returns {Entity} - the newly created entity
 */
ECS.prototype.createEntity = function (arg) {
  var ent = new Entity();

  if (arg) {
    var components = null, c = 0;

    if (typeof arg === "string") {
      // arg is the name of an entity schema
      var schema = this._entities[arg];

      if (schema) {
        components = schema;
      }
    } else {
      // arg is already an entity schema (list of components)
      components = arg;
    }

    // iterate over components list and clone schemas into real components
    for (; c &lt; components.length; c += 1) {
      var name = components[c],
        data   = this._components[name];

      ent.update(name, data);
    }
  }

  return this.addEntity(ent);
};

/**
 * add an entity to the current ecs
 * @param {Entity} entity - the entity to add
 */
ECS.prototype.addEntity = function (entity) {
  // listen for entity events
  entity.on('add', this._onComponentAdd(entity));
  entity.on('update', this._onComponentUpdate(entity));
  entity.on('remove', this._onComponentRemove(entity));

  this.entities.push(entity);

  /**
   * add entity event
   * @event ECS#addEntity
   * @param {Entity} entity - added entity
   */
  this.emit('addEntity', entity);

  return entity;
};

/**
 * tests if an entity exists
 * @param {string|Entity} arg0 - the entity id if string&lt;br/>
 * the entity instance if object
 * @returns {boolean} - true if the entity exists, false otherwise
 */
ECS.prototype.hasEntity = function (arg0) {
  var id = typeof arg0 === 'object' ? arg0.id : arg0;

  return _getIndexByProperty(this.entities, 'id', id) !== -1;
};

/**
 * remove an entity by id
 * @param {string|Entity} arg0 - the entity id if string&lt;br/>
 * the entity instance if object
 */
ECS.prototype.removeEntity = function (arg0) {
  var id  = typeof arg0 === 'object' ? arg0.id : arg0,
    index = _getIndexByProperty(this.entities, 'id', id),
    ent   = null;

  if (index !== -1) {
    ent = this.entities.splice(index, 1)[0];

    /**
     * remove entity event
     * @event ECS#removeEntity
     * @param {Entity} entity - entity removed
     */
    this.emit("removeEntity", ent);
  }
};

/**
 * register a component schema to be used by entity factory
 * @param {string} name - the name of the schema
 * @param {object} defaults - an object containing the default
 * values, take the form of: &lt;br/>
 * &lt;pre>
 *   {
 *     property1: "value",
 *     property2: 123456
 *   }
 * &lt;/pre>
 */
ECS.prototype.registerComponent = function (name, defaults) {
  this._components[name] = defaults;
};

/**
 * create a closure that broadcast an add event from an entity. The main goal
 * of this closure is to append the entity object in the event arguments
 * @param {Entity} entity - the entity
 * @returns {Function} - the created callback
 * @private
 */
ECS.prototype._onComponentAdd = function (entity) {
  var self = this;

  return function (name, data) {
    self._broadcast('componentAdd', [entity, name, data]);
  };
};

/**
 * create a closure that broadcast an update event from an entity. The main goal
 * of this closure is to append the entity object in the event arguments
 * @param {Entity} entity - the entity
 * @returns {Function} - the created callback
 * @private
 */
ECS.prototype._onComponentUpdate = function (entity) {
  var self = this;

  return function (name, data) {
    self._broadcast('componentUpdate', [entity, name, data]);
  };
};

/**
 * create a closure that broadcast a remove event from an entity. The main goal
 * of this closure is to append the entity object in the event arguments
 * @param {Entity} entity - the entity
 * @returns {Function} - the created callback
 * @private
 */
ECS.prototype._onComponentRemove = function (entity) {
  var self = this;

  return function (name, data) {
    self._broadcast('componentRemove', [entity, name, data]);
  };
};

/**
 * broadcast an event to all systems
 * @param {string} event - name of the event
 * @param {*} args - arguments of the event
 * @private
 */
ECS.prototype._broadcast = function (event, args) {
  // prepend event as the first argument
  args.unshift(event);

  this.emit.apply(this, args);
};</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a>
		on Tue Dec 02 2014 17:45:56 GMT+0100 (Paris, Madrid) using the <a href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>


	<script>  Sunlight.highlightAll({lineNumbers:,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {
			$( "#toc" ).toc( {
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : 60
			} );
			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );

		} );
	</script>

	

</body>
</html>
